(()=>{"use strict";(()=>{const t=jQuery,e=window.mewzWcas&&mewzWcas.headerActions||{};let n;function i(){const e=t(this);if(!n){const i=t(`<form action="${e.data("action")}" method="post" enctype="multipart/form-data" style="display: none;"></form>`);n=t('<input type="file" name="import_file" />'),n.on("change",(()=>i.submit())),t("body").append(i.append(n))}n[0].click()}const a=jQuery,o=window.mewzWcas&&mewzWcas.attributeOptions||{};let s,r;const l=jQuery,{restUrl:c,restNonce:u,locale:d}=window.mewzWcas&&mewzWcas.stockListData||{};let p;function f(t,e=!1){let n=e?t.prev("tr"):t.next("tr");return n.length||(n=e?t.siblings("tr:last-of-type"):t.siblings("tr:first-of-type")),n}const m=jQuery,{__:h,sprintf:g}=wp.i18n;function y(t){const e=m(this).closest("tr").find("td.column-title .row-title").text(),n=g(h("Are you sure you want to delete %s?"),`"${e}"`);confirm(n)||t.preventDefault()}e.html&&(t(e.html).insertAfter(".wrap > .page-title-action"),t("#mewz-wcas-import-button").on("click",i)),s=a("#filter_attribute"),r=a("#filter_term"),s.length&&r.length&&(s.on("change",(function(){const t=function(t){if(!o[t])return[];let e=[];const n=o[t].terms;for(let t=0;t<n.length;t++)e.push(a("<option/>",{value:n[t][0],text:n[t][1]}));return e}(+s.val());r.find('option:not([value=""])').remove(),r.append(t),r.val(""),r.prop("hidden",!t.length)})),s.closest("form")[0].reset()),c&&(p=l("#the-list"),p.on("click",".inline-edit-controls[data-value] .action-button",(function(){const t=l(this),e=t.parent(),n=e.closest("td"),i=t.data("action"),a=+e.data("value"),o="adjust_quantity"===i?"adjust":"edit",s=(m="adjust_quantity"===i?"":a,h=-1!==i.indexOf("quantity")?(0).toLocaleString(d,{minimumFractionDigits:2}):0,l("<input/>",{type:"number",value:m,class:"inline-edit-input",step:"any",lang:d,placeholder:h,enterkeyhint:"send"})),r=l('<span class="icon"></span>'),p=l(`<span class="inline-edit-input-wrap ${o}"></span>`);var m,h;let g,y;function w(){const t=+s.val();if(v(),"adjust_quantity"===i?!t:t===a)return;g=n.find("> :first-child"),i.startsWith("set_")&&(y=g.html(),g.text(t.toLocaleString(d,{maximumSignificantDigits:20,maximumFractionDigits:20}))),n.addClass("inline-edit-pending"),n.find(".action-button").prop("disabled",!0);const o={action:i,value:t};(function(t,e){return l.ajax({url:c+"/inline-edit/"+t+"?_locale=user",method:"POST",dataType:"json",data:e,beforeSend(t){t.setRequestHeader("X-WP-Nonce",u)}})})(e.data("stock-id"),o).done(b).error(_).always(k)}function v(){p.remove(),n.removeClass("inline-editing")}function b(t){if(!t||!("updated"in t)||!("value"in t))return _();t.formatted_quantity?g.replaceWith(t.formatted_quantity):(g.text(t.value),g.attr("class",g.attr("class").replace(/ value-[\w-]+/," value-"+t.value))),e.data("value",t.value),n.trigger("mewz_wcas_inline_edited",[t])}function _(){y&&g.html(y)}function k(){n.removeClass("inline-edit-pending"),n.find(".action-button").prop("disabled",!1)}n.append(p.append(s,r)),s.select(),n.addClass("inline-editing"),s.on("blur",v),s.on("keydown",(function(t){if("Escape"===t.key)v();else{if("Enter"===t.key)return t.stopPropagation(),t.preventDefault(),w(),!1;if("Tab"===t.key){w();const e=function(t,e,n=!1){let i=f(t,n);if(i.is(t))return!1;let a=i.find(e);if(!a.length)return!1;for(;a.prop("disabled");){if(i=f(i,n),i.is(t))return!1;if(a=i.find(e),!a.length)return!1}return a}(n.parent("tr"),`.inline-edit-controls .action-button[data-action="${i}"]`,t.shiftKey);e&&(t.preventDefault(),e.click())}}}))}))),function(){const t=document.querySelector(".wp-list-table");t&&t.addEventListener("click",(t=>{if(!t.target.dataset.show||"BUTTON"!==t.target.tagName||!t.target.classList.contains("show-more")||!t.target.classList.contains("mewz-wcas-chip"))return;const e=t.target.parentNode.querySelectorAll(`.mewz-wcas-chip-${t.target.dataset.show}.hidden`);t.target.remove();for(const t of e)t.classList.remove("hidden")}))}(),function(){const t=m("#the-list");t.length&&t.on("click","tr.status-publish .action-trash",y)}(),jQuery('[rel="tiptip"]').tipTip({fadeIn:50,fadeOut:50,delay:200})})()})();